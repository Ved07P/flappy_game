<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Flappy Bird</title>
<style>
  body { margin: 0; padding: 0; background: #333; overflow: hidden; font-family: sans-serif; }
  canvas { display: block; width: 100%; height: 100vh; background: #70c5ce; }
  #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: flex; justify-content: center; align-items: center; flex-direction: column; }
  #score { font-size: 4rem; color: white; text-shadow: 2px 2px 0 #000; position: absolute; top: 10%; margin: 0; }
  #msg { font-size: 2rem; color: white; text-shadow: 2px 2px 0 #000; background: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px; text-align: center; }
  #assets { display: none; }
</style>
</head>
<body>

<div id="assets">
  <img id="playerImg" src="player.png" alt="bird"> 
  <audio id="jumpSound" src="jump.mp3"></audio>
</div>

<canvas id="gameCanvas"></canvas>

<div id="ui">
  <h1 id="score">0</h1>
  <div id="msg">TAP TO START</div>
</div>

<script> 
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const msgEl = document.getElementById('msg');

// Resize Logic
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

// Game Variables
let frames = 0;
let score = 0;
let gameState = 'START'; // START, PLAYING, GAMEOVER
let gameSpeed = 3;

// Bird Object
const bird = {
    x: 50, y: 150, w: 30, h: 30, dy: 0, gravity: 0.4, jump: 6,
    draw: function() {
        ctx.fillStyle = "yellow";
        ctx.fillRect(this.x, this.y, this.w, this.h);
        ctx.strokeStyle = "black";
        ctx.strokeRect(this.x, this.y, this.w, this.h);
        // Eye
        ctx.fillStyle = "black";
        ctx.fillRect(this.x + 20, this.y + 5, 5, 5);
    },
    update: function() {
        this.dy += this.gravity;
        this.y += this.dy;
        // Floor Hit
        if (this.y + this.h >= canvas.height) { this.y = canvas.height - this.h; gameOver(); }
        // Ceiling Hit
        if (this.y < 0) { this.y = 0; this.dy = 0; }
    },
    flap: function() {
        this.dy = -this.jump;
    }
};

// Pipes
const pipes = {
    items: [], gap: 150, dx: 3,
    update: function() {
        if (frames % 100 === 0) {
            let topH = Math.random() * (canvas.height - this.gap - 100) + 50;
            this.items.push({ x: canvas.width, top: topH, passed: false });
        }
        for (let i = 0; i < this.items.length; i++) {
            let p = this.items[i];
            p.x -= this.dx;

            // Draw Top Pipe
            ctx.fillStyle = "#73BF2E";
            ctx.fillRect(p.x, 0, 50, p.top);
            ctx.strokeRect(p.x, 0, 50, p.top);

            // Draw Bottom Pipe
            let bottomY = p.top + this.gap;
            let bottomH = canvas.height - bottomY;
            ctx.fillRect(p.x, bottomY, 50, bottomH);
            ctx.strokeRect(p.x, bottomY, 50, bottomH);

            // Collision
            if (bird.x + bird.w > p.x && bird.x < p.x + 50) {
                if (bird.y < p.top || bird.y + bird.h > bottomY) gameOver();
            }

            // Score
            if (p.x + 50 < bird.x && !p.passed) {
                score++; scoreEl.innerText = score; p.passed = true;
            }
            
            // Remove
            if (p.x < -60) { this.items.shift(); i--; }
        }
    }
};

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    if (gameState === 'PLAYING') {
        bird.update();
        pipes.update();
        frames++;
    } else if (gameState === 'START') {
        bird.y = canvas.height / 2 + Math.sin(Date.now() / 200) * 10;
        bird.draw();
    }
    
    if (gameState !== 'GAMEOVER') {
        bird.draw();
        requestAnimationFrame(loop);
    } else {
        bird.draw();
    }
}

function gameOver() {
    gameState = 'GAMEOVER';
    msgEl.innerHTML = "GAME OVER<br><small>Tap to Restart</small>";
    msgEl.style.display = 'block';
}

function reset() {
    bird.y = canvas.height / 2; bird.dy = 0;
    pipes.items = [];
    score = 0; scoreEl.innerText = 0; frames = 0;
    gameState = 'PLAYING';
    msgEl.style.display = 'none';
    loop();
}

// Input Handling
window.addEventListener('keydown', e => {
    if (e.code === 'Space') action();
});
window.addEventListener('touchstart', e => {
    e.preventDefault(); // Stop zoom
    action();
}, {passive: false});
window.addEventListener('mousedown', action);

function action() {
    if (gameState === 'START') reset();
    else if (gameState === 'PLAYING') bird.flap();
    else if (gameState === 'GAMEOVER') reset();
}

loop(); 
</script>
</body>
</html>
